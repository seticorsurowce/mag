<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Etykiety</title>

  <link rel="stylesheet" href="style.css">

  
</head>
<body>
  <!-- MENU -->
  <nav>
    <a href="index.html">Surowce</a>
    <a href="#" class="active">Etykiety</a>
  </nav>

  <div class="container">
<div class="form-selector">
  <button type="button" class="form-button przyjecie active" onclick="setMode('przyjecie')">Przyjęcie</button>
  <button type="button" class="form-button wydanie" onclick="setMode('wydanie')">Wydanie</button>
</div>


    <form id="etykietyForm" onsubmit="handleSubmit(event)">
      <div class="form-group">
        <label for="indeks">Indeks towaru:</label>
        <input type="text" id="indeks" name="indeks" required oninput="updatePreview()">
        <div id="indeks-preview"></div>
      </div>
      <div class="form-group">
        <label for="kar">Miejsce (KAR):</label>
        <select id="kar" name="kar" required>
          <option value="">-- Wybierz --</option>
          <option value="KAR01">KAR01</option>
          <option value="KAR02">KAR02</option>
          <option value="KAR03">KAR03</option>
          <option value="KAR04">KAR04</option>
          <option value="KAR05">KAR05</option>
          <option value="KAR06">KAR06</option>
          <option value="KAR07">KAR07</option>
          <option value="KAR08">KAR08</option>
          <option value="KAR09">KAR09</option>
          <option value="KAR10">KAR10</option>
          <option value="KAR11">KAR11</option>
          <option value="KAR12">KAR12</option>
        </select>
      </div>
      <div class="form-group">
        <label for="ilosc">Ilość:</label>
        <div class="ilosc-row">
  <input type="text" id="ilosc" name="ilosc" required>
  <label><input type="radio" name="jednostka" value="1000szt" required> 1000 szt.</label>
  <label><input type="radio" name="jednostka" value="rolka"> rolka</label>
</div>

      </div>
      <div class="form-actions">
        <button type="submit" class="submit-btn">Wyślij</button>
        <button type="button" class="reset-btn" onclick="resetForm()">Resetuj</button>
      </div>
    </form>
  </div>

  <script>

let mode = 'przyjecie';

function setMode(selected) {
  mode = selected; // <- ważne, żeby zmieniało arkusz docelowy
  document.querySelectorAll('.form-button').forEach(btn => {
    btn.classList.remove('active');
  });
  document.querySelector('.form-button.' + selected).classList.add('active');
}




    
    


    function updatePreview() {
      const val = document.getElementById('indeks').value.trim();
      let out = val;
      if (val.includes("|")) {
        out = val.split("|").pop().trim();
      }
      document.getElementById('indeks-preview').innerText = out ? `Indeks: ${out}` : "";
    }

    function handleSubmit(event) {
  event.preventDefault();
  
  const formData = new FormData(event.target);
  let indeksRaw = formData.get('indeks');
  let indeks = indeksRaw;
  if (indeksRaw.includes("|")) {
    indeks = indeksRaw.split("|").pop().trim();
  }

  const data = {
    typ: mode,
    indeks: indeks, // <- już tylko część po "|"
    kar: formData.get('kar'),
    ilosc: formData.get('ilosc'),
    jednostka: formData.get('jednostka'),
    timestamp: new Date().toISOString()
  };

  let sheetName = mode === 'przyjecie' ? 'przyjecia_imp' : 'wydania_imp';

  fetch('https://script.google.com/macros/s/AKfycbyO7tq1OsI48-P2jgT__hoLEepjzrlVLEzJ-_mhS6pWf68LZOZhPQK2c0WaXkyfTsmS/exec', {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ sheet: sheetName, ...data })
  })
  .then(() => {
      alert("Dane zostały wysłane!");
      event.target.reset(); 
      document.getElementById('indeks-preview').innerText = ""; // też czyścimy podgląd
  })
  .catch(error => {
      console.error('Error:', error);
      alert("Wystąpił błąd podczas wysyłania danych: " + error);
  });
}

    function resetForm() {
      const form = document.getElementById('etykietyForm');
      form.reset();
      document.getElementById('indeks-preview').innerText = ""; // czyści podgląd
    }
  </script>
</body>
</html>
