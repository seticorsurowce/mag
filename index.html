<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>surowce</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">

    <style>

	body {
	            font-family: Arial, sans-serif;
	 }
@media (max-width: 600px) {
    body {
        padding: 10px;
    }

    select, input[type="number"], input[type="text"], button {
        width: 100%;
        margin-top: 10px;
    }

    .hidden {
        display: block;
        max-height: none;
    }
}



	    
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>Kalkulator surowców</h1>
    <form id="calcForm">
        <label for="search">Wyszukaj surowiec:</label>
        <input type="text" id="search" oninput="filterMaterials()" placeholder="Wpisz nazwę surowca...">
        <select id="material" onchange="calculate()" size="6" class="hidden">
            <option value="0.140">Półbłysk</option>
            <option value="0.140">Coated FH21</option>
            <option value="0.140">Coated RP3000</option>
            <option value="0.140">Adestor A251</option>
            <option value="0.140">MC S2000</option>
            <option value="0.140">MCS2045</option>
            <option value="0.150">Thermal Eco</option>
        </select>
        <br><br>
        <label for="totalWeight">Całkowita waga surowca (kg):</label>
        <input type="number" id="totalWeight" oninput="calculate()" required>
        <br><br>
        <label for="width">Szerokość surowca (mm):</label>
        <input type="number" id="width" oninput="calculate()" required>
        <br><br>
        <button type="button" onclick="sendDataToSheet()">Wyślij</button>
    </form>
    <h3>Wynik:</h3>
    <div id="result"></div>

    <script>
	document.addEventListener('DOMContentLoaded', function () {
    var searchInput = document.getElementById('search');
    searchInput.addEventListener('input', filterMaterials); // Zmiana z 'keyup' na 'input'
});

        let lastCalculation = {};

        function filterMaterials() {
            var input = document.getElementById('search').value.toLowerCase();
            var select = document.getElementById('material');
            var options = select.options;
            var hidden = true;

            for (var i = 0; i < options.length; i++) {
                var txtValue = options[i].textContent || options[i].innerText;
                if (txtValue.toLowerCase().indexOf(input) > -1) {
                    options[i].style.display = "";
                    hidden = false;
                } else {
                    options[i].style.display = "none";
                }
            }

            select.className = hidden ? 'hidden' : '';
        }

		function calculate() {
			var materialName = document.getElementById('material').options[document.getElementById('material').selectedIndex].text;
			var materialDensity = parseFloat(document.getElementById('material').value);
			var totalWeight = parseFloat(document.getElementById('totalWeight').value);
			var width = parseFloat(document.getElementById('width').value);
			var result = totalWeight / materialDensity / width * 1000; // Prawidłowe obliczenie
			result = Math.ceil(result / 10) * 10; 

            document.getElementById('result').innerText = "Wynik: " + result;

            lastCalculation = {
                material: materialName,
                weight: totalWeight,
                width: width,
                result: result,
                timestamp: new Date().toISOString()
            };
        }

        function sendDataToSheet() {
            if (!lastCalculation.material) {
                alert("Proszę najpierw obliczyć wynik.");
                return;
            }
			console.log(JSON.stringify(lastCalculation));

            fetch('https://script.google.com/macros/s/AKfycbxJB3TKv26aFkPZNcaYvpxKrfy8Fr_XGnD3TagYBEdFFQ6h61E-daMAHJLjWUN0CkTe/exec', {
                method: 'POST',
                mode: 'no-cors',  // Opcjonalnie, w zależności od konfiguracji CORS
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(lastCalculation)
            })
            .then(response => {
                console.log('Sent data successfully');
                alert("Dane zostały wysłane!");
            })
            .catch(error => {
                console.error('Error:', error);
                alert("Wystąpił błąd podczas wysyłania danych: " + error);
            });
        }
    </script>
</body>
</html>
